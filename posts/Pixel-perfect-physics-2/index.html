<!DOCTYPE html><html lang="fr-FR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="[2/3] Réaliser sa propre physique pour du Pixel Art" /><meta property="og:locale" content="fr_FR" /><meta name="description" content="[2/3] Les Acteurs" /><meta property="og:description" content="[2/3] Les Acteurs" /><link rel="canonical" href="https://carbone13.github.io//posts/Pixel-perfect-physics-2/" /><meta property="og:url" content="https://carbone13.github.io//posts/Pixel-perfect-physics-2/" /><meta property="og:site_name" content="Carbone_13 Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-09T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[2/3] Réaliser sa propre physique pour du Pixel Art" /><meta name="twitter:site" content="@mchl_lucas" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"[2/3] Les Acteurs","url":"https://carbone13.github.io//posts/Pixel-perfect-physics-2/","@type":"BlogPosting","headline":"[2/3] Réaliser sa propre physique pour du Pixel Art","dateModified":"2021-04-10T23:33:56+02:00","datePublished":"2021-04-09T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://carbone13.github.io//posts/Pixel-perfect-physics-2/"},"@context":"https://schema.org"}</script><title>[2/3] Réaliser sa propre physique pour du Pixel Art | Carbone_13 | Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/rounded.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Carbone_13 | Blog</a></div><div class="site-subtitle font-italic">Fait mu-muse avec des pixels</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>PAR CATÉGORIE</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>À PROPOS DE MOI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Carbone13" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/mchl_lucas" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['lucas.michaudel','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[2/3] Réaliser sa propre physique pour du Pixel Art</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Rechercher..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[2/3] Réaliser sa propre physique pour du Pixel Art</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lucas Michaudel </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 9, 2021, 12:00 AM +0200" prep="on" > Apr 9 <i class="unloaded">2021-04-09T00:00:00+02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 10, 2021, 11:33 PM +0200" prefix="Updated " > Apr 10 <i class="unloaded">2021-04-10T23:33:56+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1310 words">7 min</span></div></div><div class="post-content"><h1 id="23--les-acteurs">[2/3] Les Acteurs</h1><hr /><p class="text-justify">Dans le précédent article, j’ai plusieurs fois parler d’Acteur, en fait un Acteur désigne une entité qui va se déplacer dans la scène tout en collisionant avec les autres boîtes de collisions. Par exemple Mario serait un Acteur, un Goomba aussi.</p><p class="text-justify">Personnellement je crée une class abstraite que j’appelle Actor. Abstraite signifie qu’elle ne peux pas être utiliser comme ça, il faut forcément crée une deuxième classe qui en dérive pour l’utiliser. Le but ensuite, c’est de crée des fonctions dans la classe Actor que tout les classes qui en hérite pourront utiliser.</p><h2 id="se-déplacer-pixel-par-pixel">Se déplacer pixel par pixel</h2><hr /><p class="text-justify">Pour que nos Acteurs se déplacent pixel par pixel, il faut stocker le mouvement de ce dernier, est dès lors qu’il est d’au moins 1 pixel, on déplace réellement le joueur dans la scène. Chaque Acteur possède donc une variable de type Vector2 que j’appelle remainder qui stock donc les déplacements, elle est public mais je la cache dans l’éditeur grâce à HideInInspector. Ensuite les Acteur possèdent une fonction <code class="language-plaintext highlighter-rouge">Move()</code> qui prend en paramètre un Vector2 qui représente la distance à parcourir. Les deux autres arguments sont des callbacks qui sont appelé lorsqu’il y a une collision. Ils sont de type Action. Aussi il est important que chaque Acteur possède une boîte de collision.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Actor</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="n">Rectangle</span> <span class="n">collider</span><span class="p">;</span>
	<span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span>
	<span class="k">public</span> <span class="n">Vector2</span> <span class="n">remainder</span><span class="p">;</span>

	<span class="k">private</span> <span class="k">void</span> <span class="nf">Awake</span> <span class="p">()</span>
	<span class="p">{</span>
		<span class="n">collider</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rectangle</span><span class="p">&gt;();</span>
	<span class="p">}</span>

	<span class="k">protected</span> <span class="k">void</span> <span class="nf">Move</span> <span class="p">(</span><span class="n">Vector2</span> <span class="n">amount</span><span class="p">,</span> <span class="n">Action</span> <span class="n">xCallback</span><span class="p">,</span> <span class="n">Action</span> <span class="n">yCallback</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nf">MoveX</span><span class="p">(</span><span class="n">amount</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xCallback</span><span class="p">);</span>
		<span class="nf">MoveY</span><span class="p">(</span><span class="n">amount</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">yCallback</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p class="text-justify">Ensuite chaque mouvement est divisé en 2 phase, on s’occupe d’abord de déplacement horizontalement le joueur, puis verticalement, axe par axe. Ces deux fonctions sont les mêmes, alors pour le tutoriel je ne vais en détailler qu’une seul (les deux fonctions seront tout de même disponible à la fin de l’article). Le principe est simple, déjà on vérifie que la distance à bouger n’est pas de zéro, si c’est n’est pas le cas, on l’ajoute dans notre remainder, on va ensuite arrondir le remainder à l’entier le plus proche. Si la valeur arrondie n’est pas zéro, alors on doit déplacer notre joueur d’un certain nombre de pixel. Noter que cette valeur peux être négative.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">void</span> <span class="nf">MoveX</span> <span class="p">(</span><span class="kt">float</span> <span class="n">amount</span><span class="p">,</span> <span class="n">Action</span> <span class="n">callback</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">amount</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

	<span class="n">remainder</span><span class="p">.</span><span class="n">x</span> <span class="p">+=</span> <span class="n">amount</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">toMove</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Round</span><span class="p">(</span><span class="n">remainder</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">toMove</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">remainder</span><span class="p">.</span><span class="n">x</span> <span class="p">-=</span> <span class="n">toMove</span><span class="p">;</span>
		<span class="nf">PixelMoveX</span> <span class="p">(</span><span class="n">toMove</span><span class="p">,</span> <span class="n">callback</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p class="text-justify">Enfin, on appelle la fonction <code class="language-plaintext highlighter-rouge">PixelMove()</code>, qui prend en paramètre un int. Cette dernière fonction simule chaque pixel un par un au lieu de les faire en même temps. Cela permet de calculer les positions entre le point de départ et celui d’arrivée. Le principe est simple, pour chaque déplacement d’un pixel, on regarde si l’on va collisioner un objet à la “position voulue”. Si oui on ne bouge pas, si non on déplace le transform du joueur. Si l’on collisione, alors on quitte la fonction, et on remet à zéro le remainder afin d’éviter d’accumuler de la vitesse. L’opération est répétée pour chaque pixel (sauf s’il y a eu collision).</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">void</span> <span class="nf">PixelMoveX</span> <span class="p">(</span><span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="n">Action</span> <span class="n">callback</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">sign</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Sign</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>

	<span class="k">while</span><span class="p">(</span><span class="n">amount</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Rectangle</span> <span class="n">hit</span> <span class="p">=</span> <span class="nf">First</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="nf">v2i</span><span class="p">()</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">right</span> <span class="p">*</span> <span class="n">sign</span><span class="p">);</span>

		<span class="k">if</span><span class="p">(</span><span class="n">hit</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="nf">v2i</span><span class="p">()</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">right</span> <span class="p">*</span> <span class="n">sign</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="c1">// Collision !</span>
			<span class="n">remainder</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
			<span class="n">callback</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">();</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p class="text-justify">On retrouve par ailleurs la fonction v2i cité dans le premier article. La dernière fonction qu’il reste à élucider est la fonction First Elle permet de retourner le premier Rectangle touché par notre boîte à une position donnée. Son fonctionnement est simple, elle vérifie chacune des autres boîtes présentes dans la scène. On vérifie d’abord si collidable est true, et que la boîte n’est pas la notre. Puis, si on collisione avec, on la retourne. A savoir que la fonction <code class="language-plaintext highlighter-rouge">Overlaps()</code> provient de la structure RectInt.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="n">Rectangle</span> <span class="nf">First</span> <span class="p">(</span><span class="n">Vector2</span> <span class="n">position</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">RectInt</span> <span class="n">colliderAtPosition</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectInt</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="nf">v2i</span><span class="p">()</span> <span class="p">+</span> <span class="n">collider</span><span class="p">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">collider</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>

	<span class="k">foreach</span><span class="p">(</span><span class="n">Rectangle</span> <span class="n">rect</span> <span class="k">in</span> <span class="n">Tracker</span><span class="p">.</span><span class="n">colliders</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">collidable</span> <span class="p">&amp;&amp;</span> <span class="n">rect</span> <span class="p">!=</span> <span class="n">collider</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">colliderAtPosition</span><span class="p">.</span><span class="nf">Overlaps</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">Bounds</span><span class="p">))</span>
			<span class="p">{</span>
				<span class="k">return</span> <span class="n">rect</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Voici Actor.cs dans sa version complète :</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Actor</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="n">Rectangle</span> <span class="n">collider</span><span class="p">;</span>
	<span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span>
	<span class="k">public</span> <span class="n">Vector2</span> <span class="n">remainder</span><span class="p">;</span>

	<span class="k">private</span> <span class="k">void</span> <span class="nf">Awake</span> <span class="p">()</span>
	<span class="p">{</span>
		<span class="n">collider</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rectangle</span><span class="p">&gt;();</span>
	<span class="p">}</span>

	<span class="k">protected</span> <span class="k">void</span> <span class="nf">Move</span> <span class="p">(</span><span class="n">Vector2</span> <span class="n">amount</span><span class="p">,</span> <span class="n">Action</span> <span class="n">xCallback</span><span class="p">,</span> <span class="n">Action</span> <span class="n">yCallback</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nf">MoveX</span><span class="p">(</span><span class="n">amount</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xCallback</span><span class="p">);</span>
		<span class="nf">MoveY</span><span class="p">(</span><span class="n">amount</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">yCallback</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">void</span> <span class="nf">MoveX</span> <span class="p">(</span><span class="kt">float</span> <span class="n">amount</span><span class="p">,</span> <span class="n">Action</span> <span class="n">callback</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">amount</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

		<span class="n">remainder</span><span class="p">.</span><span class="n">x</span> <span class="p">+=</span> <span class="n">amount</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">toMove</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Round</span><span class="p">(</span><span class="n">remainder</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>

		<span class="k">if</span><span class="p">(</span><span class="n">toMove</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">remainder</span><span class="p">.</span><span class="n">x</span> <span class="p">-=</span> <span class="n">toMove</span><span class="p">;</span>
			<span class="nf">PixelMoveX</span> <span class="p">(</span><span class="n">toMove</span><span class="p">,</span> <span class="n">callback</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">void</span> <span class="nf">MoveY</span> <span class="p">(</span><span class="kt">float</span> <span class="n">amount</span><span class="p">,</span> <span class="n">Action</span> <span class="n">callback</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">amount</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

		<span class="n">remainder</span><span class="p">.</span><span class="n">y</span> <span class="p">+=</span> <span class="n">amount</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">toMove</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Round</span><span class="p">(</span><span class="n">remainder</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

		<span class="k">if</span><span class="p">(</span><span class="n">toMove</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">remainder</span><span class="p">.</span><span class="n">y</span> <span class="p">-=</span> <span class="n">toMove</span><span class="p">;</span>
			<span class="nf">PixelMoveY</span> <span class="p">(</span><span class="n">toMove</span><span class="p">,</span> <span class="n">callback</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">void</span> <span class="nf">PixelMoveX</span> <span class="p">(</span><span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="n">Action</span> <span class="n">callback</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">sign</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Sign</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>

		<span class="k">while</span><span class="p">(</span><span class="n">amount</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Rectangle</span> <span class="n">hit</span> <span class="p">=</span> <span class="nf">First</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="nf">v2i</span><span class="p">()</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">right</span> <span class="p">*</span> <span class="n">sign</span><span class="p">);</span>

			<span class="k">if</span><span class="p">(</span><span class="n">hit</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">amount</span> <span class="p">-=</span> <span class="n">sign</span><span class="p">;</span>
				<span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="nf">v2i</span><span class="p">()</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">right</span> <span class="p">*</span> <span class="n">sign</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="c1">// Collision !</span>
				<span class="n">remainder</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
				<span class="n">callback</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">();</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">void</span> <span class="nf">PixelMoveY</span> <span class="p">(</span><span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="n">Action</span> <span class="n">callback</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">sign</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Sign</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>

		<span class="k">while</span><span class="p">(</span><span class="n">amount</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Rectangle</span> <span class="n">hit</span> <span class="p">=</span> <span class="nf">First</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="nf">v2i</span><span class="p">()</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">up</span> <span class="p">*</span> <span class="n">sign</span><span class="p">);</span>

			<span class="k">if</span><span class="p">(</span><span class="n">hit</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">amount</span> <span class="p">-=</span> <span class="n">sign</span><span class="p">;</span>
				<span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="nf">v2i</span><span class="p">()</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">up</span><span class="p">*</span> <span class="n">sign</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="c1">// Collision !</span>
				<span class="n">remainder</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
				<span class="n">callback</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">();</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">private</span> <span class="n">Rectangle</span> <span class="nf">First</span> <span class="p">(</span><span class="n">Vector2</span> <span class="n">position</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">RectInt</span> <span class="n">colliderAtPosition</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectInt</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="nf">v2i</span><span class="p">()</span> <span class="p">+</span> <span class="n">collider</span><span class="p">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">collider</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>

		<span class="k">foreach</span><span class="p">(</span><span class="n">Rectangle</span> <span class="n">rect</span> <span class="k">in</span> <span class="n">Tracker</span><span class="p">.</span><span class="n">colliders</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">collidable</span> <span class="p">&amp;&amp;</span> <span class="n">rect</span> <span class="p">!=</span> <span class="n">collider</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="n">colliderAtPosition</span><span class="p">.</span><span class="nf">Overlaps</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">Bounds</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="k">return</span> <span class="n">rect</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="k">null</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="en-situation-réelle">En situation réelle</h2><hr /><p class="text-justify">N’oubliez pas qu’Actor est un classe abstraite, il faut forcément crée une classe qui en dérive pour l’utiliser. Voici une classe Player basique pour vous montrer comment l’utiliser :</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Player</span> <span class="p">:</span> <span class="n">Actor</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="kt">float</span> <span class="n">MoveSpeed</span> <span class="p">=</span> <span class="m">75.0f</span><span class="p">;</span>

	<span class="k">public</span> <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span>
	<span class="p">{</span>
		<span class="kt">float</span> <span class="n">xInput</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="nf">GetAxisRaw</span><span class="p">(</span><span class="s">"Horizontal"</span><span class="p">);</span>
		<span class="kt">float</span> <span class="n">yInput</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="nf">GetAxisRaw</span><span class="p">(</span><span class="s">"Vertical"</span><span class="p">);</span>

		<span class="n">Vector2</span> <span class="n">inputs</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">xInput</span><span class="p">,</span> <span class="n">yInput</span><span class="p">);</span>

		<span class="nf">Move</span><span class="p">(</span><span class="n">inputs</span><span class="p">.</span><span class="n">normalized</span> <span class="p">*</span> <span class="n">MoveSpeed</span> <span class="p">*</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p class="text-justify">On dérive d’abord d’Actor, ensuite je déclare une variable MoveSpeed qui correspond à la vitesse du joueur en pixel par seconde. Dans une fonction Update je récupère les axes Horizontal et Vertical (qui correspondent aux flèche directionnelle ou à ZQSD).</p><p class="text-justify">Enfin je déplacer mon joueur en fonction de mes touches (que je normalize pour transformer le tout en direction), je multiplie par ma vitesse et par Delta Time (voir futur article sur le delta time).</p><p class="text-justify">Quant aux callbacks, je ne souhaite pas les utiliser alors je passe un callback null. Si vous calculer vous même votre velocity, il est préférable de le remettre à 0 sur l’axe correspondant à la même manière que le remainder.</p><h2 id="résultat-final-sur-unity">Résultat final sur Unity</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/pixelartphysic/actortest.gif" alt="Héléna qui coure dans tout les sens" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/2d/'>2D</a>, <a href='/categories/physic/'>Physic</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Partager</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[2/3] Réaliser sa propre physique pour du Pixel Art - Carbone_13 | Blog&url=https://carbone13.github.io//posts/Pixel-perfect-physics-2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[2/3] Réaliser sa propre physique pour du Pixel Art - Carbone_13 | Blog&u=https://carbone13.github.io//posts/Pixel-perfect-physics-2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[2/3] Réaliser sa propre physique pour du Pixel Art - Carbone_13 | Blog&url=https://carbone13.github.io//posts/Pixel-perfect-physics-2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Récent</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Pixel-perfect-physics-1/">[1/3] Réaliser sa propre physique pour du Pixel Art</a><li><a href="/posts/Pixel-perfect-physics-2/">[2/3] Réaliser sa propre physique pour du Pixel Art</a><li><a href="/posts/Pixel-perfect-physics-3/">[3/3] Réaliser sa propre physique pour du Pixel Art</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Sommaire</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Autres articles</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Pixel-perfect-physics-1/"><div class="card-body"> <span class="timeago small" > Apr 8 <i class="unloaded">2021-04-08T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[1/3] Réaliser sa propre physique pour du Pixel Art</h3><div class="text-muted small"><p> [1/3] Intro &amp; AABB Lorsqu’on souhaite réaliser un jeu en 2D sur Unity, on peut se laisser tenter par son système de Physique et de Collisions. Malheureusement il est assez laborieux d’avoir...</p></div></div></a></div><div class="card"> <a href="/posts/Pixel-perfect-physics-3/"><div class="card-body"> <span class="timeago small" > Apr 10 <i class="unloaded">2021-04-10T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[3/3] Réaliser sa propre physique pour du Pixel Art</h3><div class="text-muted small"><p> [3/3] Les Solides Maintenant que nous en avons terminé avec les Acteurs, il est temps de s’attaquer au deuxième type d’entité : les Solides. Ce que j’appelle un Solide, c’est une entité qui se ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Pixel-perfect-physics-1/" class="btn btn-outline-primary" prompt="Précédent"><p>[1/3] Réaliser sa propre physique pour du Pixel Art</p></a> <a href="/posts/Pixel-perfect-physics-3/" class="btn btn-outline-primary" prompt="Suivant"><p>[3/3] Réaliser sa propre physique pour du Pixel Art</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/Carbone13">Lucas Michaudel</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://carbone13.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
